<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Crypto Hunters – Admin Panel</title>
  <style>
    body { font-family: ui-sans-serif, system-ui; background: #0b1020; color: #e5e7eb; max-width: 960px; margin: 40px auto; }
    h1 { margin-bottom: 0.5rem; }
    .card { background: #141a33; padding: 1rem; border-radius: 12px; margin-bottom: 1rem; }
    input, button { padding: 0.5rem; border-radius: 8px; border: none; }
    button { margin-left: 0.5rem; font-weight: bold; }
    .badge { padding: 0.25rem 0.5rem; border-radius: 8px; font-size: 0.75rem; }
    .pending { background: #fbbf24; color: #1f2937; }
    .approved { background: #60a5fa; color: #1f2937; }
    .sent { background: #34d399; color: #1f2937; }
  </style>
</head>
<body>
  <h1>Admin Panel</h1>
  <div class="card">
    <label>Admin Key <input id="adm" placeholder="x-admin-key" /></label>
    <div style="margin-top: 8px;">
      <button onclick="loadWithdraws()">Load Withdraw Requests</button>
      <button onclick="loadBridges()">Load Bridge Requests</button>
    </div>
  </div>
  <div id="list"></div>
  <script>
    // Fetch JSON with admin key header
    async function fetchAdmin(url, options = {}) {
      const key = document.getElementById('adm').value || '';
      const headers = options.headers || {};
      headers['x-admin-key'] = key;
      return fetch(url, { ...options, headers });
    }

    // Load withdraw requests and render
    async function loadWithdraws() {
      const resp = await fetchAdmin('/api/withdraw/requests');
      const data = await resp.json();
      renderWithdraws(data);
    }

    // Load bridge requests and render
    async function loadBridges() {
      const resp = await fetchAdmin('/api/bridge/requests');
      const data = await resp.json();
      renderBridges(data);
    }

    // Render withdraw requests
    function renderWithdraws(requests) {
      const list = document.getElementById('list');
      list.innerHTML = '';
      requests.forEach(req => {
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `<b>${req.id}</b> • <span class="badge ${req.status}">${req.status}</span><br/>
          Wallet: ${req.wallet}<br/>
          Amount: ${req.amount}<br/>
          Created: ${req.createdAt}<br/>
          ${req.sentAt ? 'Sent: ' + req.sentAt + '<br/>' : ''}
          <button onclick="approveWithdraw('${req.id}')">Approve</button>
          <button onclick="markSentWithdraw('${req.id}')">Mark Sent</button>`;
        list.appendChild(div);
      });
    }

    // Render bridge requests
    function renderBridges(requests) {
      const list = document.getElementById('list');
      list.innerHTML = '';
      requests.forEach(req => {
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `<b>${req.id}</b> • <span class="badge ${req.status}">${req.status}</span><br/>
          Type: ${req.type}<br/>
          Wallet: ${req.wallet}<br/>
          ${req.thrAddress ? 'Thronos: ' + req.thrAddress + '<br/>' : ''}
          Amount: ${req.amount}<br/>
          Created: ${req.createdAt}<br/>
          <button onclick="approveBridge('${req.id}')">Approve</button>
          <button onclick="completeBridge('${req.id}')">Complete</button>`;
        list.appendChild(div);
      });
    }

    // Approve withdraw request
    async function approveWithdraw(id) {
      await fetchAdmin('/api/withdraw/approve/' + id, { method: 'POST' });
      loadWithdraws();
    }

    // Mark withdraw request as sent
    async function markSentWithdraw(id) {
      await fetchAdmin('/api/withdraw/mark-sent/' + id, { method: 'POST' });
      loadWithdraws();
    }

    // Approve bridge request
    async function approveBridge(id) {
      await fetchAdmin('/api/bridge/approve/' + id, { method: 'POST' });
      loadBridges();
    }

    // Complete bridge request
    async function completeBridge(id) {
      await fetchAdmin('/api/bridge/complete/' + id, { method: 'POST' });
      loadBridges();
    }
  </script>
</body>
</html>