<!DOCTYPE html>
<html>
<head>
  <title>{% block title %}Thronos Network{% endblock %}</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/thronos-token.png') }}">
  <link rel="shortcut icon" type="image/png" href="{{ url_for('static', filename='img/thronos-token.png') }}">
  <style>
    /* Global Styles */
    body {
      background-color: #000;
      color: #0f0;
      font-family: "Courier New", monospace;
      padding: 20px;
      line-height: 1.6;
      margin: 0;
    }
    a {
      color: #0f0;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
      background-color: #111;
    }
    h1, h2, h3 {
      color: #0f0;
      border-bottom: 1px solid #0f0;
      padding-bottom: 10px;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    /* Navigation Bar */
    .navbar {
      background: #111;
      border-bottom: 1px solid #0f0;
      padding: 0;
      margin-bottom: 30px;
      display: flex;
      justify-content: center;
      position: relative;
      flex-wrap: wrap;
    }
    
    .nav-list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .nav-item {
      position: relative;
    }
    
    .nav-link {
      display: block;
      padding: 15px 20px;
      color: #0f0;
      font-weight: bold;
      cursor: pointer;
    }
    
    .nav-link:hover {
      background-color: #222;
      text-decoration: none;
    }
    .thr-logo-icon {
      width: 24px;
      height: 24px;
      vertical-align: middle;
      margin-right: 8px;
      border-radius: 50%;
      box-shadow: 0 0 8px #ff6600;
      animation: pulse 2s ease-in-out infinite;
    }
    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 8px #ff6600; }
      50% { box-shadow: 0 0 16px #ff9900, 0 0 24px #ff6600; }
    }

    
    /* Dropdown Menu */
    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #111;
      min-width: 180px;
      box-shadow: 0px 8px 16px 0px rgba(0,255,0,0.2);
      border: 1px solid #0f0;
      z-index: 10;
      top: 100%;
      left: 0;
    }
    
    .dropdown-content a {
      color: #0f0;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      text-align: left;
    }
    
    .dropdown-content a:hover {
      background-color: #222;
    }
    
    .nav-item:hover .dropdown-content {
      display: block;
    }
    
    /* Top Bar Controls */
    .top-controls {
        position: absolute;
        top: 10px;
        right: 10px;
        display: flex;
        gap: 10px;
        z-index: 100;
    }
    
    /* Wallet Status Indicator */
    .wallet-status {
        background: #002200;
        color: #0f0;
        border: 1px solid #004400;
        padding: 5px 10px;
        font-size: 0.8em;
        cursor: pointer;
        display: none;
        align-items: center;
        gap: 6px;
        position: relative;
    }
    .wallet-status:hover {
        background: #004400;
    }
    .wallet-status:hover .wallet-balance-popup {
        display: block;
    }
    .wallet-fire-icon {
        width: 16px;
        height: 16px;
        vertical-align: middle;
        filter: drop-shadow(0 0 4px #ff6600);
    }

    /* Wallet Balance Popup Widget */
    .wallet-balance-popup {
        display: none;
        position: absolute;
        top: 100%;
        right: 0;
        margin-top: 5px;
        background: #071810;
        border: 1px solid #1a3b2e;
        border-radius: 12px;
        padding: 15px;
        min-width: 280px;
        max-width: 350px;
        box-shadow: 0 0 20px rgba(0, 255, 102, 0.2);
        z-index: 1000;
        color: #e6ffe5;
    }
    .wallet-popup-header {
        font-size: 12px;
        font-weight: 600;
        color: #00ff66;
        margin-bottom: 10px;
        padding-bottom: 8px;
        border-bottom: 1px solid #1a3b2e;
    }
    .wallet-popup-tokens {
        display: flex;
        flex-direction: column;
        gap: 8px;
        max-height: 300px;
        overflow-y: auto;
    }
    .wallet-popup-token {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px;
        background: rgba(0, 255, 102, 0.05);
        border-radius: 8px;
        border: 1px solid rgba(0, 255, 102, 0.1);
    }
    .wallet-popup-logo {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        font-weight: bold;
        border: 1px solid;
    }
    .wallet-popup-logo img {
        width: 100%;
        height: 100%;
        border-radius: 50%;
    }
    .wallet-popup-info {
        flex: 1;
        font-size: 11px;
    }
    .wallet-popup-symbol {
        font-weight: 600;
        color: #e6ffe5;
    }
    .wallet-popup-balance {
        text-align: right;
        font-size: 12px;
        font-weight: 600;
        font-family: monospace;
    }
    .wallet-popup-total {
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px solid #1a3b2e;
        text-align: center;
        font-size: 11px;
        color: #56ff9a;
    }
    .wallet-popup-total-amount {
        font-size: 16px;
        font-weight: 700;
        color: #00ff66;
        margin-top: 4px;
    }
    .wallet-popup-loading {
        text-align: center;
        padding: 20px;
        color: #56ff9a;
        font-size: 11px;
    }
    .wallet-popup-spinner {
        border: 2px solid rgba(0, 255, 102, 0.2);
        border-top: 2px solid #00ff66;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 1s linear infinite;
        margin: 0 auto 10px;
    }
    
    /* Disconnect Button */
    .disconnect-btn {
        background: #220000;
        color: #f00;
        border: 1px solid #440000;
        padding: 5px 10px;
        font-size: 0.8em;
        cursor: pointer;
        display: none;
    }
    .disconnect-btn:hover {
        background: #440000;
    }
    
    /* Language Toggle */
    .lang-toggle {
        background: #222;
        color: #0f0;
        border: 1px solid #0f0;
        padding: 5px 10px;
        cursor: pointer;
    }
    .lang-en { display: none; }

    /* Utility Classes */
    .highlight { color: #ff0; }
    .btn {
        display: inline-block;
        background: #0f0;
        color: #000;
        padding: 10px 20px;
        font-weight: bold;
        text-decoration: none;
        border: 1px solid #000;
        cursor: pointer;
    }
    .btn:hover { background: #0c0; }
    
    /* Loading Spinner */
    .spinner {
        display: inline-block;
        width: 12px;
        height: 12px;
        border: 2px solid rgba(0,0,0,0.3);
        border-radius: 50%;
        border-top-color: #000;
        animation: spin 1s ease-in-out infinite;
        margin-right: 8px;
        vertical-align: middle;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Page Specific Styles Block */
    {% block styles %}{% endblock %}
  </style>
</head>
<body>

<div class="top-controls">
    <div id="walletStatus" class="wallet-status">
        <img src="{{ url_for('static', filename='img/thronos-token.png') }}" alt="ğŸ”¥" class="wallet-fire-icon" />
        <span id="walletAddrShort"></span>

        <!-- Wallet Balance Popup Widget -->
        <div class="wallet-balance-popup" id="walletBalancePopup" onclick="event.stopPropagation();">
            <div class="wallet-popup-loading">
                <div class="wallet-popup-spinner"></div>
                Loading balances...
            </div>
        </div>
    </div>
    <button id="disconnectBtn" class="disconnect-btn" onclick="disconnectWallet()">
        âœ– <span class="lang-el">Î‘Ï€Î¿ÏƒÏÎ½Î´ÎµÏƒÎ·</span><span class="lang-en">Disconnect</span>
    </button>
    <button class="lang-toggle" onclick="toggleLanguage()">GR | EN</button>
</div>

<div class="navbar">
  <ul class="nav-list">
    <li class="nav-item brand">
      <span class="nav-link">
        <img src="{{ url_for('static', filename='img/thronos-token.png') }}" alt="ğŸ”¥" class="thr-logo-icon" />
        THRONOS
      </span>
    </li>
    <!-- Home -->
    <li class="nav-item">
      <a href="/" class="nav-link">ğŸ  <span class="lang-el">Î‘ÏÏ‡Î¹ÎºÎ®</span><span class="lang-en">Home</span></a>
    </li>
    
    <!-- Apps Dropdown -->
    <li class="nav-item">
      <span class="nav-link">ğŸ“± <span class="lang-el">Î•Ï†Î±ÏÎ¼Î¿Î³Î­Ï‚</span><span class="lang-en">Apps</span> â–¼</span>
      <div class="dropdown-content">
        <a href="/wallet">ğŸ‘› <span class="lang-el">Î Î¿ÏÏ„Î¿Ï†ÏŒÎ»Î¹</span><span class="lang-en">Wallet</span></a>
        <a href="/send">ğŸ’¸ <span class="lang-el">Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®</span><span class="lang-en">Send</span></a>
        <a href="/swap">ğŸ”„ Swap</a>
        <a href="/gateway">ğŸ’³ Gateway</a>
        <a href="/evm">âš¡ <span class="lang-el">Smart Contracts</span><span class="lang-en">Smart Contracts</span></a>
        <a href="/game">ğŸ® <span class="lang-el">Î Î±Î¹Ï‡Î½Î¯Î´Î¹</span><span class="lang-en">Game</span></a>
        <a href="/pledge">ğŸ”¥ <span class="lang-el">Î”Î­ÏƒÎ¼ÎµÏ…ÏƒÎ·</span><span class="lang-en">Pledge</span></a>
        <a href="/viewer">ğŸ“¦ <span class="lang-el">Î•Î¾ÎµÏÎµÏ…Î½Î·Ï„Î®Ï‚</span><span class="lang-en">Explorer</span></a>
        <a href="/token_chart">ğŸ“ˆ <span class="lang-el">Î“ÏÎ¬Ï†Î·Î¼Î± Token</span><span class="lang-en">Token Chart</span></a>
      </div>
    </li>

    <!-- Services Dropdown -->
    <li class="nav-item">
      <span class="nav-link">ğŸŒ <span class="lang-el">Î¥Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚</span><span class="lang-en">Services</span> â–¼</span>
      <div class="dropdown-content">
        <a href="/bridge">ğŸŒ‰ <span class="lang-el">Î“Î­Ï†Ï…ÏÎ± BTC</span><span class="lang-en">BTC Bridge</span></a>
        <a href="/iot">ğŸš— <span class="lang-el">IoT ÎšÏŒÎ¼Î²Î¿Î¹</span><span class="lang-en">IoT Nodes</span></a>
        <a href="/chat">ğŸ¤– <span class="lang-el">AI Chat</span><span class="lang-en">AI Chat</span></a>
        <a href="/ai_packs">ğŸ’ <span class="lang-el">AI Credits</span><span class="lang-en">AI Credits</span></a>
        <a href="/architect">ğŸ—ï¸ <span class="lang-el">AI Architect</span><span class="lang-en">AI Architect</span></a>
      </div>
    </li>
    
    <!-- Docs Dropdown -->
    <li class="nav-item">
      <span class="nav-link">ğŸ“š <span class="lang-el">ÎˆÎ³Î³ÏÎ±Ï†Î±</span><span class="lang-en">Docs</span> â–¼</span>
      <div class="dropdown-content">
        <a href="/whitepaper">ğŸ“„ <span class="lang-el">Whitepaper</span><span class="lang-en">Whitepaper</span></a>
        <a href="/roadmap">ğŸ—ºï¸ <span class="lang-el">Roadmap</span><span class="lang-en">Roadmap</span></a>
        <a href="/tokenomics">ğŸ“œ <span class="lang-el">Tokenomics</span><span class="lang-en">Tokenomics</span></a>
      </div>
    </li>
    
    <!-- Recovery -->
    <li class="nav-item">
      <a href="/recovery" class="nav-link">ğŸ› ï¸ <span class="lang-el">Î‘Î½Î¬ÎºÏ„Î·ÏƒÎ·</span><span class="lang-en">Recovery</span></a>
    </li>
  </ul>
</div>

<div class="container">
  {% block content %}{% endblock %}
</div>

<script>
// Global Language Logic
function toggleLanguage() {
    const currentLang = localStorage.getItem('lang') || 'el';
    const newLang = currentLang === 'el' ? 'en' : 'el';
    setLanguage(newLang);
}

function setLanguage(lang) {
    localStorage.setItem('lang', lang);
    const elElements = document.querySelectorAll('.lang-el');
    const enElements = document.querySelectorAll('.lang-en');
    
    if (lang === 'el') {
        elElements.forEach(el => el.style.display = 'inline');
        enElements.forEach(el => el.style.display = 'none');
    } else {
        elElements.forEach(el => el.style.display = 'none');
        enElements.forEach(el => el.style.display = 'inline');
    }
    
    // Trigger custom event for pages that need to re-render content
    window.dispatchEvent(new CustomEvent('langChanged', { detail: { lang: lang } }));
}

// Disconnect Wallet Function
function disconnectWallet() {
    if (confirm('Are you sure you want to disconnect your wallet?')) {
        localStorage.removeItem('thr_address');
        localStorage.removeItem('thr_secret');
        document.getElementById('walletStatus').style.display = 'none';
        document.getElementById('disconnectBtn').style.display = 'none';
        window.location.href = '/';
    }
}

// Wallet Balance Widget Functions
let walletBalancesLoaded = false;

async function loadWalletBalances() {
    if (walletBalancesLoaded) return; // Only load once

    const wallet = localStorage.getItem('thr_address');
    if (!wallet) return;

    const popup = document.getElementById('walletBalancePopup');

    try {
        const response = await fetch(`/api/wallet/tokens/${wallet}?show_zero=false`);
        if (!response.ok) throw new Error('Failed to load wallet data');

        const data = await response.json();
        renderWalletBalances(data);
        walletBalancesLoaded = true;
    } catch (error) {
        popup.innerHTML = `
            <div class="wallet-popup-header">ğŸ’ Wallet Balance</div>
            <div style="text-align: center; color: #ff4d4d; font-size: 11px; padding: 10px;">
                Failed to load balances
            </div>
        `;
    }
}

function renderWalletBalances(data) {
    const popup = document.getElementById('walletBalancePopup');
    const tokens = data.tokens || [];

    // Calculate total balance
    const totalTHR = tokens.reduce((sum, t) => {
        if (t.symbol === 'THR') return sum + t.balance;
        if (t.symbol === 'WBTC') return sum + (t.balance * 50000);
        if (t.symbol === 'L2E') return sum + t.balance;
        return sum;
    }, 0);

    let html = `
        <div class="wallet-popup-header">ğŸ’ Wallet Balance</div>
        <div class="wallet-popup-tokens">
    `;

    tokens.forEach(token => {
        html += `
            <div class="wallet-popup-token">
                <div class="wallet-popup-logo" style="border-color: ${token.color};">
                    ${token.logo ? `<img src="${token.logo}" alt="${token.symbol}" onerror="this.style.display='none';">` : `<span style="color: ${token.color};">${token.symbol[0]}</span>`}
                </div>
                <div class="wallet-popup-info">
                    <div class="wallet-popup-symbol">${token.symbol}</div>
                </div>
                <div class="wallet-popup-balance" style="color: ${token.color};">
                    ${token.balance.toFixed(token.decimals)}
                </div>
            </div>
        `;
    });

    html += `
        </div>
        <div class="wallet-popup-total">
            Total Portfolio
            <div class="wallet-popup-total-amount">${totalTHR.toFixed(2)} THR</div>
        </div>
    `;

    popup.innerHTML = html;
}

// Initialize language and wallet status on load
document.addEventListener('DOMContentLoaded', () => {
    const savedLang = localStorage.getItem('lang') || 'el';
    setLanguage(savedLang);

    // Check wallet status
    const wallet = localStorage.getItem('thr_address');
    if (wallet) {
        const short = wallet.substring(0, 6) + '...' + wallet.substring(wallet.length - 4);
        const statusEl = document.getElementById('walletStatus');
        const disconnectEl = document.getElementById('disconnectBtn');

        if(statusEl) {
            document.getElementById('walletAddrShort').textContent = short;
            statusEl.style.display = 'flex';

            // Load wallet balances on hover
            statusEl.addEventListener('mouseenter', loadWalletBalances);
        }
        if(disconnectEl) {
            disconnectEl.style.display = 'block';
        }
    }
});
</script>

{% block scripts %}{% endblock %}

</body>
</html>
