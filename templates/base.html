<!DOCTYPE html>
<html>
<head>
  <title>{% block title %}Thronos Network{% endblock %}</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/thronos-token.png') }}">
  <link rel="shortcut icon" type="image/png" href="{{ url_for('static', filename='img/thronos-token.png') }}">
  <style>
    /* Global Styles */
    body {
      background-color: #000;
      color: #0f0;
      font-family: "Courier New", monospace;
      padding: 20px;
      line-height: 1.6;
      margin: 0;
    }
    a {
      color: #0f0;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
      background-color: #111;
    }
    h1, h2, h3 {
      color: #0f0;
      border-bottom: 1px solid #0f0;
      padding-bottom: 10px;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    /* Navigation Bar */
    .navbar {
      background: #111;
      border-bottom: 1px solid #0f0;
      padding: 0;
      margin-bottom: 30px;
      display: flex;
      justify-content: center;
      position: relative;
      flex-wrap: wrap;
    }
    
    .nav-list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .nav-item {
      position: relative;
    }
    
    .nav-link {
      display: block;
      padding: 15px 20px;
      color: #0f0;
      font-weight: bold;
      cursor: pointer;
    }
    
    .nav-link:hover {
      background-color: #222;
      text-decoration: none;
    }
    .thr-logo-icon {
      width: 24px;
      height: 24px;
      vertical-align: middle;
      margin-right: 8px;
      border-radius: 50%;
      box-shadow: 0 0 8px #ff6600;
      animation: pulse 2s ease-in-out infinite;
    }
    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 8px #ff6600; }
      50% { box-shadow: 0 0 16px #ff9900, 0 0 24px #ff6600; }
    }

    
    /* Dropdown Menu */
    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #111;
      min-width: 180px;
      box-shadow: 0px 8px 16px 0px rgba(0,255,0,0.2);
      border: 1px solid #0f0;
      z-index: 10;
      top: 100%;
      left: 0;
    }
    
    .dropdown-content a {
      color: #0f0;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      text-align: left;
    }
    
    .dropdown-content a:hover {
      background-color: #222;
    }
    
    .nav-item:hover .dropdown-content {
      display: block;
    }
    
    /* Top Bar Controls */
    .top-controls {
        position: absolute;
        top: 10px;
        right: 10px;
        display: flex;
        gap: 10px;
        z-index: 100;
    }
    
    /* Wallet Status Indicator */
    .wallet-status {
        background: #002200;
        color: #0f0;
        border: 1px solid #004400;
        padding: 5px 10px;
        font-size: 0.8em;
        cursor: pointer;
        display: none;
        align-items: center;
        gap: 6px;
        position: relative;
    }
    .wallet-status:hover {
        background: #004400;
    }
    .wallet-status:hover .wallet-balance-popup {
        display: block;
    }
    .wallet-fire-icon {
        width: 16px;
        height: 16px;
        vertical-align: middle;
        filter: drop-shadow(0 0 4px #ff6600);
    }

    /* Wallet Balance Popup Widget */
    .wallet-balance-popup {
        display: none;
        position: absolute;
        top: 100%;
        right: 0;
        margin-top: 8px;
        background: linear-gradient(135deg, #000000 0%, #071810 50%, #000000 100%);
        border: 2px solid;
        border-image: linear-gradient(135deg, #d4af37 0%, #00ff66 50%, #ffd700 100%) 1;
        border-radius: 12px;
        padding: 15px;
        min-width: 300px;
        max-width: 360px;
        box-shadow: 0 0 30px rgba(0, 255, 102, 0.3), 0 0 15px rgba(255, 215, 0, 0.2);
        z-index: 1000;
        color: #e6ffe5;
        backdrop-filter: blur(10px);
    }

    /* Chain Tokens Widget (Footer) */
    .chain-tokens-widget {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(180deg, transparent 0%, rgba(0, 20, 10, 0.95) 20%, rgba(0, 30, 15, 0.98) 100%);
        border-top: 2px solid;
        border-image: linear-gradient(90deg, transparent, #00ff66, #ffd700, #00ff66, transparent) 1;
        padding: 10px 20px;
        z-index: 999;
        backdrop-filter: blur(10px);
    }
    .chain-tokens-inner {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 15px;
    }
    .chain-supply-box {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .chain-supply-label {
        font-size: 10px;
        color: #56ff9a;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    .chain-supply-amount {
        font-size: 16px;
        font-weight: 700;
        background: linear-gradient(135deg, #ffd700 0%, #00ff66 50%, #ffed4e 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        filter: drop-shadow(0 0 5px rgba(0, 255, 102, 0.4));
    }
    .chain-tokens-scroll {
        display: flex;
        gap: 12px;
        overflow-x: auto;
        flex: 1;
        padding: 5px 0;
        max-width: 70%;
    }
    .chain-token-pill {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        background: linear-gradient(135deg, rgba(0, 255, 102, 0.1) 0%, rgba(0, 40, 20, 0.3) 100%);
        border: 1px solid rgba(0, 255, 102, 0.3);
        border-radius: 20px;
        white-space: nowrap;
        transition: all 0.3s;
        cursor: default;
    }
    .chain-token-pill:hover {
        border-color: #00ff66;
        background: linear-gradient(135deg, rgba(0, 255, 102, 0.2) 0%, rgba(0, 40, 20, 0.4) 100%);
        box-shadow: 0 0 10px rgba(0, 255, 102, 0.2);
    }
    .chain-token-logo {
        width: 18px;
        height: 18px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 8px;
        font-weight: bold;
        border: 1px solid;
    }
    .chain-token-logo img {
        width: 100%;
        height: 100%;
        border-radius: 50%;
    }
    .chain-token-symbol {
        font-size: 11px;
        font-weight: 600;
        color: #e6ffe5;
    }
    .chain-token-supply {
        font-size: 10px;
        color: #56ff9a;
        font-family: monospace;
    }
    .chain-token-holders {
        font-size: 9px;
        color: #ffd700;
        font-family: monospace;
        padding: 2px 4px;
        background: rgba(255, 215, 0, 0.1);
        border-radius: 4px;
    }
    .wallet-popup-header {
        font-size: 13px;
        font-weight: 700;
        background: linear-gradient(135deg, #ffd700 0%, #00ff66 50%, #ffed4e 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 12px;
        padding-bottom: 10px;
        border-bottom: 2px solid;
        border-image: linear-gradient(90deg, transparent, #00ff66, transparent) 1;
        text-align: center;
        letter-spacing: 1px;
        text-transform: uppercase;
    }
    .wallet-popup-tokens {
        display: flex;
        flex-direction: column;
        gap: 8px;
        max-height: 300px;
        overflow-y: auto;
    }
    .wallet-popup-token {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px;
        background: linear-gradient(135deg, rgba(26, 59, 46, 0.2) 0%, rgba(0, 255, 102, 0.05) 100%);
        border-radius: 10px;
        border: 1px solid rgba(0, 255, 102, 0.2);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }
    .wallet-popup-token::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.1), transparent);
        transition: left 0.5s;
    }
    .wallet-popup-token:hover {
        background: linear-gradient(135deg, rgba(26, 59, 46, 0.4) 0%, rgba(0, 255, 102, 0.1) 100%);
        border-color: #00ff66;
        box-shadow: 0 0 15px rgba(0, 255, 102, 0.2), inset 0 0 10px rgba(0, 255, 102, 0.05);
        transform: translateX(-2px);
    }
    .wallet-popup-token:hover::before {
        left: 100%;
    }
    .wallet-popup-logo {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        font-weight: bold;
        border: 1px solid;
    }
    .wallet-popup-logo img {
        width: 100%;
        height: 100%;
        border-radius: 50%;
    }
    .wallet-popup-info {
        flex: 1;
        font-size: 11px;
    }
    .wallet-popup-symbol {
        font-weight: 600;
        color: #e6ffe5;
    }
    .wallet-popup-balance {
        text-align: right;
        font-size: 12px;
        font-weight: 600;
        font-family: monospace;
    }
    .wallet-popup-total {
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px solid #1a3b2e;
        text-align: center;
        font-size: 11px;
        color: #56ff9a;
    }
    .wallet-popup-total-amount {
        font-size: 18px;
        font-weight: 700;
        background: linear-gradient(135deg, #ffd700 0%, #00ff66 50%, #ffed4e 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-top: 4px;
        filter: drop-shadow(0 0 10px rgba(0, 255, 102, 0.5));
        animation: popup-balance-glow 2s ease-in-out infinite;
    }
    @keyframes popup-balance-glow {
        0%, 100% {
            filter: drop-shadow(0 0 10px rgba(0, 255, 102, 0.5));
        }
        50% {
            filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.6));
        }
    }
    .wallet-popup-loading {
        text-align: center;
        padding: 20px;
        color: #56ff9a;
        font-size: 11px;
    }
    .wallet-popup-spinner {
        border: 2px solid rgba(0, 255, 102, 0.2);
        border-top: 2px solid #00ff66;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 1s linear infinite;
        margin: 0 auto 10px;
    }
    .wallet-popup-actions {
        margin-top: 12px;
        padding-top: 10px;
        border-top: 1px solid #1a3b2e;
        display: flex;
        gap: 8px;
    }
    .wallet-popup-btn {
        flex: 1;
        padding: 8px 12px;
        background: linear-gradient(135deg, rgba(0, 255, 102, 0.1) 0%, rgba(0, 255, 102, 0.2) 100%);
        border: 1px solid #00ff66;
        color: #00ff66;
        cursor: pointer;
        font-size: 11px;
        font-weight: 600;
        transition: all 0.3s;
        border-radius: 6px;
        font-family: "Courier New", monospace;
    }
    .wallet-popup-btn:hover {
        background: linear-gradient(135deg, rgba(0, 255, 102, 0.2) 0%, rgba(0, 255, 102, 0.3) 100%);
        box-shadow: 0 0 15px rgba(0, 255, 102, 0.3);
        transform: translateY(-1px);
    }

    /* Wallet History Modal */
    .history-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 10001;
        align-items: center;
        justify-content: center;
    }
    .history-modal.active {
        display: flex;
    }
    .history-modal-content {
        background: linear-gradient(135deg, #000000 0%, #071810 50%, #000000 100%);
        border: 2px solid;
        border-image: linear-gradient(135deg, #d4af37 0%, #00ff66 50%, #ffd700 100%) 1;
        border-radius: 12px;
        padding: 20px;
        max-width: 800px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        position: relative;
    }
    .history-modal-header {
        font-size: 20px;
        font-weight: 700;
        background: linear-gradient(135deg, #ffd700 0%, #00ff66 50%, #ffed4e 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid;
        border-image: linear-gradient(90deg, transparent, #00ff66, transparent) 1;
        text-align: center;
    }
    .history-modal-close {
        position: absolute;
        top: 15px;
        right: 15px;
        background: none;
        border: none;
        color: #56ff9a;
        font-size: 28px;
        cursor: pointer;
        transition: color 0.3s;
    }
    .history-modal-close:hover {
        color: #00ff66;
    }
    .history-tx-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    .history-tx-item {
        background: linear-gradient(135deg, rgba(26, 59, 46, 0.2) 0%, rgba(0, 255, 102, 0.05) 100%);
        border: 1px solid rgba(0, 255, 102, 0.2);
        border-radius: 8px;
        padding: 12px;
        transition: all 0.3s;
    }
    .history-tx-item:hover {
        border-color: #00ff66;
        box-shadow: 0 0 10px rgba(0, 255, 102, 0.2);
    }
    .history-tx-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
    }
    .history-tx-id {
        font-family: monospace;
        font-size: 11px;
        color: #56ff9a;
        cursor: pointer;
    }
    .history-tx-id:hover {
        color: #00ff66;
    }
    .history-tx-time {
        font-size: 10px;
        color: #56ff9a;
        opacity: 0.7;
    }
    .history-tx-details {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 10px;
        font-size: 11px;
    }
    .history-tx-detail {
        display: flex;
        flex-direction: column;
        gap: 3px;
    }
    .history-tx-label {
        color: #56ff9a;
        opacity: 0.8;
        text-transform: uppercase;
        font-size: 9px;
        letter-spacing: 0.5px;
    }
    .history-tx-value {
        color: #e6ffe5;
        font-family: monospace;
        font-weight: 600;
    }
    .history-tx-amount {
        color: #ffd700;
        font-weight: 700;
    }
    .history-loading {
        text-align: center;
        padding: 40px;
        color: #56ff9a;
    }
    .history-empty {
        text-align: center;
        padding: 40px;
        color: #56ff9a;
        opacity: 0.7;
    }

    /* Send Modal */
    .send-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 10000;
        align-items: center;
        justify-content: center;
    }
    .send-modal.active {
        display: flex;
    }
    .send-modal-content {
        background: linear-gradient(135deg, #000000 0%, #071810 50%, #000000 100%);
        border: 2px solid;
        border-image: linear-gradient(135deg, #d4af37 0%, #00ff66 50%, #ffd700 100%) 1;
        border-radius: 12px;
        padding: 20px;
        max-width: 400px;
        width: 90%;
        box-shadow: 0 0 40px rgba(0, 255, 102, 0.4);
    }
    .send-modal-header {
        font-size: 16px;
        font-weight: 700;
        background: linear-gradient(135deg, #ffd700 0%, #00ff66 50%, #ffed4e 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid;
        border-image: linear-gradient(90deg, transparent, #00ff66, transparent) 1;
        text-align: center;
    }
    .send-form-group {
        margin-bottom: 12px;
    }
    .send-form-label {
        display: block;
        font-size: 11px;
        color: #56ff9a;
        margin-bottom: 5px;
        font-weight: 600;
    }
    .send-form-input {
        width: 100%;
        padding: 10px;
        background: rgba(0, 0, 0, 0.5);
        border: 1px solid #1a3b2e;
        color: #e6ffe5;
        font-family: "Courier New", monospace;
        font-size: 12px;
        border-radius: 6px;
        transition: border-color 0.3s;
    }
    .send-form-input:focus {
        outline: none;
        border-color: #00ff66;
        box-shadow: 0 0 10px rgba(0, 255, 102, 0.2);
    }
    .send-speed-options {
        display: flex;
        gap: 10px;
        margin-top: 8px;
    }
    .send-speed-option {
        flex: 1;
        padding: 10px;
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid #1a3b2e;
        cursor: pointer;
        border-radius: 6px;
        text-align: center;
        transition: all 0.3s;
    }
    .send-speed-option:hover {
        border-color: #00ff66;
    }
    .send-speed-option.selected {
        background: linear-gradient(135deg, rgba(0, 255, 102, 0.2) 0%, rgba(0, 255, 102, 0.1) 100%);
        border-color: #00ff66;
        box-shadow: 0 0 15px rgba(0, 255, 102, 0.2);
    }
    .send-speed-label {
        font-size: 11px;
        font-weight: 600;
        color: #00ff66;
        margin-bottom: 3px;
    }
    .send-speed-fee {
        font-size: 9px;
        color: #56ff9a;
    }
    .send-modal-actions {
        display: flex;
        gap: 10px;
        margin-top: 15px;
    }
    .send-modal-btn {
        flex: 1;
        padding: 10px;
        border: 1px solid;
        cursor: pointer;
        font-weight: 600;
        font-size: 12px;
        border-radius: 6px;
        font-family: "Courier New", monospace;
        transition: all 0.3s;
    }
    .send-modal-btn-primary {
        background: linear-gradient(135deg, #00ff00 0%, #00ff66 100%);
        color: #000;
        border-color: #00ff66;
    }
    .send-modal-btn-primary:hover {
        box-shadow: 0 0 20px rgba(0, 255, 102, 0.4);
        transform: translateY(-1px);
    }
    .send-modal-btn-secondary {
        background: transparent;
        color: #00ff66;
        border-color: #1a3b2e;
    }
    .send-modal-btn-secondary:hover {
        border-color: #00ff66;
        background: rgba(0, 255, 102, 0.1);
    }
    .send-result {
        margin-top: 10px;
        padding: 10px;
        border-radius: 6px;
        font-size: 11px;
        display: none;
    }
    .send-result.success {
        background: rgba(0, 255, 102, 0.1);
        border: 1px solid #00ff66;
        color: #00ff66;
    }
    .send-result.error {
        background: rgba(255, 0, 0, 0.1);
        border: 1px solid #ff0000;
        color: #ff6666;
    }

    /* Network Selection */
    .send-network-options {
        display: flex;
        gap: 10px;
    }
    .send-network-option {
        flex: 1;
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px;
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid #1a3b2e;
        cursor: pointer;
        border-radius: 6px;
        transition: all 0.3s;
        position: relative;
    }
    .send-network-option:hover {
        border-color: #00ff66;
    }
    .send-network-option.selected {
        background: linear-gradient(135deg, rgba(0, 255, 102, 0.2) 0%, rgba(0, 255, 102, 0.1) 100%);
        border-color: #00ff66;
        box-shadow: 0 0 15px rgba(0, 255, 102, 0.2);
    }
    .send-network-option.disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    .coming-soon-badge {
        position: absolute;
        top: -8px;
        right: -8px;
        background: linear-gradient(135deg, #f7931a 0%, #ffb347 100%);
        color: #000;
        font-size: 8px;
        font-weight: bold;
        padding: 2px 6px;
        border-radius: 10px;
        text-transform: uppercase;
    }

    /* Token Select */
    .send-token-select {
        cursor: pointer;
    }
    .token-balance-info {
        margin-top: 6px;
        font-size: 10px;
        color: #56ff9a;
    }
    #availableBalance {
        font-family: monospace;
        color: #00ff66;
        font-weight: 600;
    }

    /* Max Amount Button */
    .max-amount-btn {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        background: linear-gradient(135deg, #00ff66 0%, #00cc52 100%);
        color: #000;
        border: none;
        padding: 4px 10px;
        font-size: 10px;
        font-weight: bold;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
    }
    .max-amount-btn:hover {
        box-shadow: 0 0 10px rgba(0, 255, 102, 0.4);
        transform: translateY(-50%) scale(1.05);
    }
    
    /* Disconnect Button */
    .disconnect-btn {
        background: #220000;
        color: #f00;
        border: 1px solid #440000;
        padding: 5px 10px;
        font-size: 0.8em;
        cursor: pointer;
        display: none;
    }
    .disconnect-btn:hover {
        background: #440000;
    }
    
    /* Language Toggle */
    .lang-toggle {
        background: #222;
        color: #0f0;
        border: 1px solid #0f0;
        padding: 5px 10px;
        cursor: pointer;
    }
    .lang-en { display: none; }

    /* Utility Classes */
    .highlight { color: #ff0; }
    .btn {
        display: inline-block;
        background: #0f0;
        color: #000;
        padding: 10px 20px;
        font-weight: bold;
        text-decoration: none;
        border: 1px solid #000;
        cursor: pointer;
    }
    .btn:hover { background: #0c0; }
    
    /* Loading Spinner */
    .spinner {
        display: inline-block;
        width: 12px;
        height: 12px;
        border: 2px solid rgba(0,0,0,0.3);
        border-radius: 50%;
        border-top-color: #000;
        animation: spin 1s ease-in-out infinite;
        margin-right: 8px;
        vertical-align: middle;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Page Specific Styles Block */
    {% block styles %}{% endblock %}
  </style>
</head>
<body>

<div class="top-controls">
    <div id="walletStatus" class="wallet-status">
        <img src="{{ url_for('static', filename='img/thronos-token.png') }}" alt="ğŸ”¥" class="wallet-fire-icon" />
        <span id="walletAddrShort"></span>

        <!-- Wallet Balance Popup Widget -->
        <div class="wallet-balance-popup" id="walletBalancePopup" onclick="event.stopPropagation();">
            <div class="wallet-popup-loading">
                <div class="wallet-popup-spinner"></div>
                Loading balances...
            </div>
        </div>
    </div>
    <button id="disconnectBtn" class="disconnect-btn" onclick="disconnectWallet()">
        âœ– <span class="lang-el">Î‘Ï€Î¿ÏƒÏÎ½Î´ÎµÏƒÎ·</span><span class="lang-en">Disconnect</span>
    </button>
    <button class="lang-toggle" onclick="toggleLanguage()">GR | EN</button>
</div>

<!-- Send Modal -->
<div class="send-modal" id="sendModal" onclick="closeSendModal(event)">
    <div class="send-modal-content" onclick="event.stopPropagation()">
        <div class="send-modal-header">ğŸ’¸ <span class="lang-el">Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® Tokens</span><span class="lang-en">Send Tokens</span></div>

        <!-- Network Selection -->
        <div class="send-form-group">
            <label class="send-form-label"><span class="lang-el">Î”Î¯ÎºÏ„Ï…Î¿</span><span class="lang-en">Network</span></label>
            <div class="send-network-options">
                <div class="send-network-option selected" data-network="thronos" onclick="selectNetwork('thronos')">
                    <img src="{{ url_for('static', filename='img/thronos-token.png') }}" alt="THR" style="width: 20px; height: 20px; border-radius: 50%;">
                    <span>Thronos Chain</span>
                </div>
                <div class="send-network-option" data-network="bitcoin" onclick="selectNetwork('bitcoin')">
                    <span style="font-size: 18px;">â‚¿</span>
                    <span>Bitcoin (Bridge)</span>
                    <span class="coming-soon-badge"><span class="lang-el">Î£ÏÎ½Ï„Î¿Î¼Î±</span><span class="lang-en">Soon</span></span>
                </div>
            </div>
        </div>

        <!-- Token Selection -->
        <div class="send-form-group">
            <label class="send-form-label"><span class="lang-el">Token</span><span class="lang-en">Token</span></label>
            <select id="sendToken" class="send-form-input send-token-select" onchange="updateTokenInfo()">
                <option value="THR" data-color="#ff6600">THR - Thronos</option>
                <option value="WBTC" data-color="#f7931a">WBTC - Wrapped Bitcoin</option>
                <option value="L2E" data-color="#00bfff">L2E - Learn-to-Earn</option>
            </select>
            <div id="tokenBalanceInfo" class="token-balance-info">
                <span class="lang-el">Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿:</span><span class="lang-en">Available:</span>
                <span id="availableBalance">0.000000</span>
            </div>
        </div>

        <div class="send-form-group">
            <label class="send-form-label"><span class="lang-el">Î Î±ÏÎ±Î»Î®Ï€Ï„Î·Ï‚</span><span class="lang-en">Recipient Address</span></label>
            <input type="text" id="sendTo" class="send-form-input" placeholder="THR..." />
        </div>

        <div class="send-form-group">
            <label class="send-form-label"><span class="lang-el">Î Î¿ÏƒÏŒ</span><span class="lang-en">Amount</span></label>
            <div style="position: relative;">
                <input type="number" id="sendAmount" class="send-form-input" placeholder="0.000000" step="0.000001" />
                <button type="button" onclick="setMaxAmount()" class="max-amount-btn">MAX</button>
            </div>
        </div>

        <div class="send-form-group">
            <label class="send-form-label"><span class="lang-el">Î¤Î±Ï‡ÏÏ„Î·Ï„Î± Î£Ï…Î½Î±Î»Î»Î±Î³Î®Ï‚</span><span class="lang-en">Transaction Speed</span></label>
            <div class="send-speed-options">
                <div class="send-speed-option" data-speed="slow" onclick="selectSpeed('slow')">
                    <div class="send-speed-label">ğŸ¢ <span class="lang-el">Î‘ÏÎ³Î®</span><span class="lang-en">Slow</span></div>
                    <div class="send-speed-fee">0.09% fee</div>
                </div>
                <div class="send-speed-option selected" data-speed="fast" onclick="selectSpeed('fast')">
                    <div class="send-speed-label">âš¡ <span class="lang-el">Î“ÏÎ®Î³Î¿ÏÎ·</span><span class="lang-en">Fast</span></div>
                    <div class="send-speed-fee">0.5% fee</div>
                </div>
            </div>
        </div>

        <div class="send-result" id="sendResult"></div>

        <div class="send-modal-actions">
            <button class="send-modal-btn send-modal-btn-secondary" onclick="closeSendModal()">
                <span class="lang-el">Î‘ÎºÏÏÏ‰ÏƒÎ·</span><span class="lang-en">Cancel</span>
            </button>
            <button class="send-modal-btn send-modal-btn-primary" onclick="submitSend()">
                <span class="lang-el">Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®</span><span class="lang-en">Send</span>
            </button>
        </div>
    </div>
</div>

<!-- Wallet History Modal -->
<div class="history-modal" id="historyModal" onclick="closeHistoryModal(event)">
    <div class="history-modal-content" onclick="event.stopPropagation()">
        <button class="history-modal-close" onclick="closeHistoryModal()">Ã—</button>
        <div class="history-modal-header">
            ğŸ“œ <span class="lang-el">Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ Î£Ï…Î½Î±Î»Î»Î±Î³ÏÎ½</span><span class="lang-en">Transaction History</span>
        </div>
        <div id="historyContent">
            <div class="history-loading">
                <div class="wallet-popup-spinner"></div>
                <p><span class="lang-el">Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÎ¿Ï...</span><span class="lang-en">Loading history...</span></p>
            </div>
        </div>
    </div>
</div>

<div class="navbar">
  <ul class="nav-list">
    <li class="nav-item brand">
      <span class="nav-link">
        <img src="{{ url_for('static', filename='img/thronos-token.png') }}" alt="ğŸ”¥" class="thr-logo-icon" />
        THRONOS
      </span>
    </li>
    <!-- Home -->
    <li class="nav-item">
      <a href="/" class="nav-link">ğŸ  <span class="lang-el">Î‘ÏÏ‡Î¹ÎºÎ®</span><span class="lang-en">Home</span></a>
    </li>
    
    <!-- Apps Dropdown -->
    <li class="nav-item">
      <span class="nav-link">ğŸ“± <span class="lang-el">Î•Ï†Î±ÏÎ¼Î¿Î³Î­Ï‚</span><span class="lang-en">Apps</span> â–¼</span>
      <div class="dropdown-content">
        <a href="/wallet">ğŸ‘› <span class="lang-el">Î Î¿ÏÏ„Î¿Ï†ÏŒÎ»Î¹</span><span class="lang-en">Wallet</span></a>
        <a href="/send">ğŸ’¸ <span class="lang-el">Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®</span><span class="lang-en">Send</span></a>
        <a href="/swap">ğŸ”„ Swap</a>
        <a href="/gateway">ğŸ’³ Gateway</a>
        <a href="/evm">âš¡ <span class="lang-el">Smart Contracts</span><span class="lang-en">Smart Contracts</span></a>
        <a href="/game">ğŸ® <span class="lang-el">Î Î±Î¹Ï‡Î½Î¯Î´Î¹</span><span class="lang-en">Game</span></a>
        <a href="/pledge">ğŸ”¥ <span class="lang-el">Î”Î­ÏƒÎ¼ÎµÏ…ÏƒÎ·</span><span class="lang-en">Pledge</span></a>
        <a href="/viewer">ğŸ“¦ <span class="lang-el">Î•Î¾ÎµÏÎµÏ…Î½Î·Ï„Î®Ï‚</span><span class="lang-en">Explorer</span></a>
        <a href="/token_chart">ğŸ“ˆ <span class="lang-el">Î“ÏÎ¬Ï†Î·Î¼Î± Token</span><span class="lang-en">Token Chart</span></a>
      </div>
    </li>

    <!-- Services Dropdown -->
    <li class="nav-item">
      <span class="nav-link">ğŸŒ <span class="lang-el">Î¥Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚</span><span class="lang-en">Services</span> â–¼</span>
      <div class="dropdown-content">
        <a href="/bridge">ğŸŒ‰ <span class="lang-el">Î“Î­Ï†Ï…ÏÎ± BTC</span><span class="lang-en">BTC Bridge</span></a>
        <a href="/iot">ğŸš— <span class="lang-el">IoT ÎšÏŒÎ¼Î²Î¿Î¹</span><span class="lang-en">IoT Nodes</span></a>
        <a href="/chat">ğŸ¤– <span class="lang-el">AI Chat</span><span class="lang-en">AI Chat</span></a>
        <a href="/ai_packs">ğŸ’ <span class="lang-el">AI Credits</span><span class="lang-en">AI Credits</span></a>
        <a href="/architect">ğŸ—ï¸ <span class="lang-el">AI Architect</span><span class="lang-en">AI Architect</span></a>
      </div>
    </li>
    
    <!-- Docs Dropdown -->
    <li class="nav-item">
      <span class="nav-link">ğŸ“š <span class="lang-el">ÎˆÎ³Î³ÏÎ±Ï†Î±</span><span class="lang-en">Docs</span> â–¼</span>
      <div class="dropdown-content">
        <a href="/whitepaper">ğŸ“„ <span class="lang-el">Whitepaper</span><span class="lang-en">Whitepaper</span></a>
        <a href="/roadmap">ğŸ—ºï¸ <span class="lang-el">Roadmap</span><span class="lang-en">Roadmap</span></a>
        <a href="/tokenomics">ğŸ“œ <span class="lang-el">Tokenomics</span><span class="lang-en">Tokenomics</span></a>
      </div>
    </li>
    
    <!-- Recovery -->
    <li class="nav-item">
      <a href="/recovery" class="nav-link">ğŸ› ï¸ <span class="lang-el">Î‘Î½Î¬ÎºÏ„Î·ÏƒÎ·</span><span class="lang-en">Recovery</span></a>
    </li>
  </ul>
</div>

<div class="container">
  {% block content %}{% endblock %}
</div>

<script>
// Global Language Logic
function toggleLanguage() {
    const currentLang = localStorage.getItem('lang') || 'el';
    const newLang = currentLang === 'el' ? 'en' : 'el';
    setLanguage(newLang);
}

function setLanguage(lang) {
    localStorage.setItem('lang', lang);
    const elElements = document.querySelectorAll('.lang-el');
    const enElements = document.querySelectorAll('.lang-en');
    
    if (lang === 'el') {
        elElements.forEach(el => el.style.display = 'inline');
        enElements.forEach(el => el.style.display = 'none');
    } else {
        elElements.forEach(el => el.style.display = 'none');
        enElements.forEach(el => el.style.display = 'inline');
    }
    
    // Trigger custom event for pages that need to re-render content
    window.dispatchEvent(new CustomEvent('langChanged', { detail: { lang: lang } }));
}

// Disconnect Wallet Function
function disconnectWallet() {
    if (confirm('Are you sure you want to disconnect your wallet?')) {
        localStorage.removeItem('thr_address');
        localStorage.removeItem('thr_secret');
        document.getElementById('walletStatus').style.display = 'none';
        document.getElementById('disconnectBtn').style.display = 'none';
        window.location.href = '/';
    }
}

// Wallet Balance Widget Functions
let walletBalancesLoaded = false;

async function loadWalletBalances() {
    if (walletBalancesLoaded) return; // Only load once

    const wallet = localStorage.getItem('thr_address');
    if (!wallet) return;

    const popup = document.getElementById('walletBalancePopup');

    try {
        const response = await fetch(`/api/wallet/tokens/${wallet}?show_zero=false`);
        if (!response.ok) throw new Error('Failed to load wallet data');

        const data = await response.json();
        renderWalletBalances(data);
        walletBalancesLoaded = true;
    } catch (error) {
        popup.innerHTML = `
            <div class="wallet-popup-header">ğŸ’ Wallet Balance</div>
            <div style="text-align: center; color: #ff4d4d; font-size: 11px; padding: 10px;">
                Failed to load balances
            </div>
        `;
    }
}

function renderWalletBalances(data) {
    const popup = document.getElementById('walletBalancePopup');
    const tokens = data.tokens || [];

    // Calculate total balance
    const totalTHR = tokens.reduce((sum, t) => {
        if (t.symbol === 'THR') return sum + t.balance;
        if (t.symbol === 'WBTC') return sum + (t.balance * 50000);
        if (t.symbol === 'L2E') return sum + t.balance;
        return sum;
    }, 0);

    let html = `
        <div class="wallet-popup-header">ğŸ’ Wallet Balance</div>
        <div class="wallet-popup-tokens">
    `;

    tokens.forEach(token => {
        html += `
            <div class="wallet-popup-token">
                <div class="wallet-popup-logo" style="border-color: ${token.color};">
                    ${token.logo ? `<img src="${token.logo}" alt="${token.symbol}" onerror="this.style.display='none'; this.parentElement.innerHTML='<span style=\\'color:${token.color}\\'>${token.symbol[0]}</span>';">` : `<span style="color: ${token.color};">${token.symbol[0]}</span>`}
                </div>
                <div class="wallet-popup-info">
                    <div class="wallet-popup-symbol">${token.symbol}</div>
                </div>
                <div class="wallet-popup-balance" style="color: ${token.color};">
                    ${token.balance.toFixed(token.decimals)}
                </div>
            </div>
        `;
    });

    html += `
        </div>
        <div class="wallet-popup-total">
            Total Portfolio
            <div class="wallet-popup-total-amount">${totalTHR.toFixed(2)} THR</div>
        </div>
        <div class="wallet-popup-actions">
            <button class="wallet-popup-btn" onclick="openSendModal(); event.stopPropagation();">
                ğŸ’¸ <span class="lang-el">Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®</span><span class="lang-en">Send</span>
            </button>
            <button class="wallet-popup-btn" onclick="openHistoryModal(); event.stopPropagation();">
                ğŸ“œ <span class="lang-el">Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ</span><span class="lang-en">History</span>
            </button>
        </div>
    `;

    popup.innerHTML = html;

    // Re-apply language settings
    const savedLang = localStorage.getItem('lang') || 'el';
    setLanguage(savedLang);
}

// Send Modal Functions
let selectedSpeed = 'fast';
let selectedNetwork = 'thronos';
let selectedToken = 'THR';
let tokenBalances = {};

function openSendModal() {
    document.getElementById('sendModal').classList.add('active');
    document.getElementById('sendResult').style.display = 'none';
    document.getElementById('sendTo').value = '';
    document.getElementById('sendAmount').value = '';
    loadTokenBalances();
    loadCustomTokens();
}

function closeSendModal(event) {
    if (!event || event.target.id === 'sendModal') {
        document.getElementById('sendModal').classList.remove('active');
    }
}

// Wallet History Modal Functions
function openHistoryModal() {
    const wallet = localStorage.getItem('thr_address');
    if (!wallet) {
        alert(currentLang === 'el' ? 'Î£Ï…Î½Î´Î­ÏƒÏ„Îµ Ï€Î¿ÏÏ„Î¿Ï†ÏŒÎ»Î¹ Ï€ÏÏÏ„Î±' : 'Connect wallet first');
        return;
    }

    const modal = document.getElementById('historyModal');
    modal.classList.add('active');
    loadWalletHistory(wallet);
}

function closeHistoryModal(event) {
    if (!event || event.target.id === 'historyModal') {
        document.getElementById('historyModal').classList.remove('active');
    }
}

async function loadWalletHistory(wallet) {
    const contentEl = document.getElementById('historyContent');
    contentEl.innerHTML = `
        <div class="history-loading">
            <div class="wallet-popup-spinner"></div>
            <p><span class="lang-el">Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÎ¿Ï...</span><span class="lang-en">Loading history...</span></p>
        </div>
    `;

    try {
        const response = await fetch(`/api/v1/address/${wallet}/history`);
        if (!response.ok) throw new Error('Failed to load history');

        const data = await response.json();
        const transactions = data.transactions || [];

        if (transactions.length === 0) {
            contentEl.innerHTML = `
                <div class="history-empty">
                    <p><span class="lang-el">Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ ÏƒÏ…Î½Î±Î»Î»Î±Î³Î­Ï‚</span><span class="lang-en">No transactions found</span></p>
                </div>
            `;
            return;
        }

        // Render transactions (most recent first)
        const reversedTxs = transactions.slice().reverse();
        let html = '<div class="history-tx-list">';

        reversedTxs.forEach(tx => {
            const isReceived = tx.to === wallet;
            const direction = isReceived ? 'ğŸ“¥' : 'ğŸ“¤';
            const directionText = isReceived
                ? (currentLang === 'el' ? 'Î›Î®ÏˆÎ·' : 'Received')
                : (currentLang === 'el' ? 'Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®' : 'Sent');

            const txId = tx.tx_id || tx.hash || 'N/A';
            const amount = tx.amount || 0;
            const fee = tx.fee || 0;
            const timestamp = tx.timestamp || 'N/A';
            const blockHeight = tx.block_height || tx.height || 'Pending';

            html += `
                <div class="history-tx-item">
                    <div class="history-tx-header">
                        <span class="history-tx-id" onclick="navigator.clipboard.writeText('${txId}')" title="${currentLang === 'el' ? 'ÎšÎ»Î¹Îº Î³Î¹Î± Î±Î½Ï„Î¹Î³ÏÎ±Ï†Î®' : 'Click to copy'}">
                            ${direction} ${txId.substring(0, 12)}...${txId.substring(txId.length - 8)}
                        </span>
                        <span class="history-tx-time">${timestamp}</span>
                    </div>
                    <div class="history-tx-details">
                        <div class="history-tx-detail">
                            <span class="history-tx-label">${currentLang === 'el' ? 'Î¤ÏÏ€Î¿Ï‚' : 'Type'}</span>
                            <span class="history-tx-value">${directionText}</span>
                        </div>
                        <div class="history-tx-detail">
                            <span class="history-tx-label">${currentLang === 'el' ? 'Î Î¿ÏƒÏŒ' : 'Amount'}</span>
                            <span class="history-tx-value history-tx-amount">${Number(amount).toFixed(6)} THR</span>
                        </div>
                        <div class="history-tx-detail">
                            <span class="history-tx-label">${currentLang === 'el' ? 'Î§ÏÎ­Ï‰ÏƒÎ·' : 'Fee'}</span>
                            <span class="history-tx-value">${Number(fee).toFixed(6)} THR</span>
                        </div>
                        <div class="history-tx-detail">
                            <span class="history-tx-label">${currentLang === 'el' ? 'Block' : 'Block'}</span>
                            <span class="history-tx-value">${blockHeight}</span>
                        </div>
                        <div class="history-tx-detail">
                            <span class="history-tx-label">${isReceived ? (currentLang === 'el' ? 'Î‘Ï€ÏŒ' : 'From') : (currentLang === 'el' ? 'Î ÏÎ¿Ï‚' : 'To')}</span>
                            <span class="history-tx-value" style="font-size: 9px;">${isReceived ? (tx.from || 'N/A').substring(0, 16) : (tx.to || 'N/A').substring(0, 16)}...</span>
                        </div>
                    </div>
                </div>
            `;
        });

        html += '</div>';
        contentEl.innerHTML = html;

    } catch (error) {
        console.error('History load error:', error);
        contentEl.innerHTML = `
            <div class="history-empty" style="color: #ff4d4d;">
                <p><span class="lang-el">âŒ Î£Ï†Î¬Î»Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚ Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÎ¿Ï</span><span class="lang-en">âŒ Error loading history</span></p>
                <p style="font-size: 11px;">${error.message}</p>
            </div>
        `;
    }
}

function selectSpeed(speed) {
    selectedSpeed = speed;
    document.querySelectorAll('.send-speed-option').forEach(opt => {
        opt.classList.remove('selected');
    });
    document.querySelector(`[data-speed="${speed}"]`).classList.add('selected');
}

function selectNetwork(network) {
    if (network === 'bitcoin') {
        // Bitcoin bridge coming soon
        const lang = localStorage.getItem('lang') || 'el';
        alert(lang === 'el' ?
            'ğŸš§ Î— Î³Î­Ï†Ï…ÏÎ± Bitcoin Î­ÏÏ‡ÎµÏ„Î±Î¹ ÏƒÏÎ½Ï„Î¿Î¼Î±! Î”ÎµÎ¯Ï„Îµ Ï„Î¿ Roadmap Î³Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚.' :
            'ğŸš§ Bitcoin Bridge coming soon! Check the Roadmap for more info.'
        );
        return;
    }
    selectedNetwork = network;
    document.querySelectorAll('.send-network-option').forEach(opt => {
        opt.classList.remove('selected');
    });
    document.querySelector(`[data-network="${network}"]`).classList.add('selected');

    // Update recipient placeholder based on network
    const toInput = document.getElementById('sendTo');
    if (network === 'thronos') {
        toInput.placeholder = 'THR...';
    } else {
        toInput.placeholder = 'bc1... or 1... or 3...';
    }
}

async function loadTokenBalances() {
    const wallet = localStorage.getItem('thr_address');
    if (!wallet) return;

    try {
        const response = await fetch(`/api/wallet/tokens/${wallet}?show_zero=true`);
        const data = await response.json();
        if (data.tokens) {
            data.tokens.forEach(t => {
                tokenBalances[t.symbol] = t.balance;
            });
            updateTokenInfo();
        }
    } catch (e) {
        console.error('Failed to load token balances:', e);
    }
}

async function loadCustomTokens() {
    try {
        const response = await fetch('/api/tokens/list');
        const data = await response.json();
        if (data.ok && data.tokens) {
            const select = document.getElementById('sendToken');
            // Add custom tokens to select
            data.tokens.forEach(token => {
                if (!select.querySelector(`option[value="${token.symbol}"]`)) {
                    const option = document.createElement('option');
                    option.value = token.symbol;
                    option.dataset.color = token.color || '#00ff66';
                    option.textContent = `${token.symbol} - ${token.name}`;
                    select.appendChild(option);
                }
            });
        }
    } catch (e) {
        console.log('No custom tokens available');
    }
}

function updateTokenInfo() {
    const select = document.getElementById('sendToken');
    selectedToken = select.value;
    const balance = tokenBalances[selectedToken] || 0;
    document.getElementById('availableBalance').textContent = balance.toFixed(6) + ' ' + selectedToken;
}

function setMaxAmount() {
    const balance = tokenBalances[selectedToken] || 0;
    // Reserve a small amount for fees
    const feeReserve = selectedSpeed === 'slow' ? balance * 0.001 : balance * 0.006;
    const maxAmount = Math.max(0, balance - feeReserve);
    document.getElementById('sendAmount').value = maxAmount.toFixed(6);
}

async function submitSend() {
    const to = document.getElementById('sendTo').value.trim();
    const amount = parseFloat(document.getElementById('sendAmount').value);
    const token = document.getElementById('sendToken').value;
    const from = localStorage.getItem('thr_address');
    const secret = localStorage.getItem('thr_secret');
    const resultDiv = document.getElementById('sendResult');

    if (!to || !amount || amount <= 0) {
        resultDiv.className = 'send-result error';
        resultDiv.textContent = 'Please enter valid recipient and amount';
        resultDiv.style.display = 'block';
        return;
    }

    if (!from || !secret) {
        resultDiv.className = 'send-result error';
        resultDiv.textContent = 'Wallet not connected';
        resultDiv.style.display = 'block';
        return;
    }

    // Validate balance
    const balance = tokenBalances[token] || 0;
    if (amount > balance) {
        resultDiv.className = 'send-result error';
        resultDiv.textContent = `Insufficient ${token} balance`;
        resultDiv.style.display = 'block';
        return;
    }

    try {
        // Calculate fee based on selected speed
        let fee = 0;
        if (selectedSpeed === 'slow') {
            fee = amount * 0.0009; // 0.09%
        } else {
            fee = amount * 0.005; // 0.5%
        }

        let response;

        if (token === 'THR') {
            // Native THR send
            const payload = {
                from_thr: from,
                to_thr: to,
                amount: amount,
                auth_secret: secret,
                speed: selectedSpeed
            };
            response = await fetch('/send_thr', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
        } else {
            // Custom token transfer
            const payload = {
                symbol: token,
                from_thr: from,
                to_thr: to,
                amount: amount,
                auth_secret: secret
            };
            response = await fetch('/api/tokens/transfer', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
        }

        const data = await response.json();

        if (data.error || data.ok === false) {
            resultDiv.className = 'send-result error';
            resultDiv.textContent = `Error: ${data.error || data.message || 'Transaction failed'}`;
            resultDiv.style.display = 'block';
        } else {
            resultDiv.className = 'send-result success';
            resultDiv.textContent = `âœ“ ${amount} ${token} sent! Fee: ${fee.toFixed(6)} THR`;
            resultDiv.style.display = 'block';

            // Reset wallet balances to reload
            walletBalancesLoaded = false;
            tokenBalances = {};

            // Reload balances
            setTimeout(() => {
                loadTokenBalances();
            }, 1000);

            // Close modal after 2 seconds
            setTimeout(() => {
                closeSendModal();
            }, 2000);
        }
    } catch (error) {
        resultDiv.className = 'send-result error';
        resultDiv.textContent = `Error: ${error.message}`;
        resultDiv.style.display = 'block';
    }
}

// Initialize language and wallet status on load
document.addEventListener('DOMContentLoaded', () => {
    const savedLang = localStorage.getItem('lang') || 'el';
    setLanguage(savedLang);

    // Check wallet status
    const wallet = localStorage.getItem('thr_address');
    if (wallet) {
        const short = wallet.substring(0, 6) + '...' + wallet.substring(wallet.length - 4);
        const statusEl = document.getElementById('walletStatus');
        const disconnectEl = document.getElementById('disconnectBtn');

        if(statusEl) {
            document.getElementById('walletAddrShort').textContent = short;
            statusEl.style.display = 'flex';

            // Load wallet balances on hover
            statusEl.addEventListener('mouseenter', loadWalletBalances);
        }
        if(disconnectEl) {
            disconnectEl.style.display = 'block';
        }
    }
});
</script>

<!-- Chain Tokens Widget (Footer) -->
<div class="chain-tokens-widget" id="chainTokensWidget">
    <div class="chain-tokens-inner">
        <div class="chain-supply-box">
            <div>
                <div class="chain-supply-label">
                    <span class="lang-el">Î£Ï…Î½Î¿Î»Î¹ÎºÎ® Î ÏÎ¿Î¼Î®Î¸ÎµÎ¹Î± THR</span>
                    <span class="lang-en">Total THR Supply</span>
                </div>
                <div class="chain-supply-amount" id="chainTotalSupply">Loading...</div>
            </div>
        </div>
        <div class="chain-tokens-scroll" id="chainTokensScroll">
            <div class="chain-token-pill">
                <span style="color: #56ff9a; font-size: 11px;">
                    <span class="lang-el">Î¦ÏŒÏÏ„Ï‰ÏƒÎ· tokens...</span>
                    <span class="lang-en">Loading tokens...</span>
                </span>
            </div>
        </div>
    </div>
</div>

<script>
// Chain Tokens Widget - Load all tokens on chain with holders count
(function() {
    async function loadChainTokensWidget() {
        try {
            // Fetch total supply
            const statsResp = await fetch('/api/network_stats');
            const stats = await statsResp.json();
            const supplyEl = document.getElementById('chainTotalSupply');
            if (supplyEl && stats.total_supply !== undefined) {
                supplyEl.textContent = Number(stats.total_supply).toLocaleString('en-US', {maximumFractionDigits: 2}) + ' THR';
            }

            // Fetch all tokens with stats (including holders count)
            let tokensWithStats = [];
            try {
                const tokensStatsResp = await fetch('/api/tokens/stats');
                const tokensStatsData = await tokensStatsResp.json();
                if (tokensStatsData.ok && tokensStatsData.tokens) {
                    tokensWithStats = tokensStatsData.tokens;
                }
            } catch(e) {
                console.log('Tokens stats API not available, using fallback');
                // Fallback to basic token list
                tokensWithStats = [
                    { symbol: 'THR', name: 'Thronos', color: '#ff6600', holders_count: 0 },
                    { symbol: 'WBTC', name: 'Wrapped Bitcoin', color: '#f7931a', holders_count: 0 },
                    { symbol: 'L2E', name: 'Learn-to-Earn', color: '#00bfff', holders_count: 0 }
                ];
            }

            // Render tokens
            const scrollEl = document.getElementById('chainTokensScroll');
            if (!scrollEl) return;

            let html = '';
            tokensWithStats.forEach(token => {
                const logoSrc = token.logo || (token.symbol === 'THR' ? '/static/img/thronos-token.png' : null);
                const logoHtml = logoSrc
                    ? `<img src="${logoSrc}" alt="${token.symbol}" onerror="this.style.display='none'; this.parentElement.innerHTML='<span style=\\'color:${token.color}\\'>${token.symbol[0]}</span>';">`
                    : `<span style="color: ${token.color};">${token.symbol[0]}</span>`;

                const holdersText = token.holders_count !== undefined
                    ? `${token.holders_count} ğŸ‘¥`
                    : '';

                const supplyText = token.total_supply
                    ? Number(token.total_supply).toLocaleString('en-US', {maximumFractionDigits: 0})
                    : '';

                html += `
                    <div class="chain-token-pill" title="${token.name} - ${holdersText || '0'} holders">
                        <div class="chain-token-logo" style="border-color: ${token.color};">${logoHtml}</div>
                        <span class="chain-token-symbol">${token.symbol}</span>
                        ${holdersText ? `<span class="chain-token-holders">${holdersText}</span>` : ''}
                        ${supplyText ? `<span class="chain-token-supply">${supplyText}</span>` : ''}
                    </div>
                `;
            });
            scrollEl.innerHTML = html;

        } catch(err) {
            console.error('Chain tokens widget error:', err);
        }
    }

    // Load on DOM ready
    document.addEventListener('DOMContentLoaded', loadChainTokensWidget);

    // Refresh every 60 seconds
    setInterval(loadChainTokensWidget, 60000);
})();
</script>

{% block scripts %}{% endblock %}

</body>
</html>
