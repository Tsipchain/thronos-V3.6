{% extends "base.html" %}

{% block title %}Thronos EVM - Smart Contracts{% endblock %}

{% block styles %}
<style>
    .evm-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }
    .evm-section {
        background: #111;
        border: 1px solid #0f0;
        padding: 20px;
        margin-bottom: 20px;
    }
    .evm-section h2 {
        color: #0f0;
        margin-top: 0;
    }
    .form-group {
        margin-bottom: 15px;
    }
    .form-group label {
        display: block;
        color: #0f0;
        margin-bottom: 5px;
    }
    .form-group input,
    .form-group textarea {
        width: 100%;
        background: #000;
        color: #0f0;
        border: 1px solid #0f0;
        padding: 8px;
        font-family: "Courier New", monospace;
    }
    .form-group textarea {
        min-height: 100px;
        font-size: 12px;
    }
    .btn-evm {
        background: #0f0;
        color: #000;
        border: none;
        padding: 10px 20px;
        cursor: pointer;
        font-weight: bold;
        margin-right: 10px;
    }
    .btn-evm:hover {
        background: #0c0;
    }
    .result-box {
        background: #000;
        border: 1px dashed #0f0;
        padding: 15px;
        margin-top: 15px;
        font-family: "Courier New", monospace;
        font-size: 12px;
        white-space: pre-wrap;
        word-break: break-all;
    }
    .contract-list {
        list-style: none;
        padding: 0;
    }
    .contract-item {
        background: #000;
        border: 1px solid #0f0;
        padding: 10px;
        margin-bottom: 10px;
    }
    .contract-item:hover {
        background: #111;
    }
    .tab-buttons {
        margin-bottom: 20px;
    }
    .tab-btn {
        background: #222;
        color: #0f0;
        border: 1px solid #0f0;
        padding: 10px 20px;
        cursor: pointer;
        margin-right: 5px;
    }
    .tab-btn.active {
        background: #0f0;
        color: #000;
    }
    .tab-content {
        display: none;
    }
    .tab-content.active {
        display: block;
    }
</style>
{% endblock %}

{% block content %}
<div class="evm-container">
    <h1>ğŸ”§ <span class="lang-el">Thronos EVM - ÎˆÎ¾Ï…Ï€Î½Î± Î£Ï…Î¼Î²ÏŒÎ»Î±Î¹Î±</span><span class="lang-en">Thronos EVM - Smart Contracts</span></h1>
    
    <p>
        <span class="lang-el">Î‘Î½Î±Ï€Ï„ÏÎ¾Ï„Îµ ÎºÎ±Î¹ ÎµÎºÏ„ÎµÎ»Î­ÏƒÏ„Îµ Î­Î¾Ï…Ï€Î½Î± ÏƒÏ…Î¼Î²ÏŒÎ»Î±Î¹Î± ÏƒÏ„Î¿ Î´Î¯ÎºÏ„Ï…Î¿ Thronos.</span>
        <span class="lang-en">Deploy and execute smart contracts on the Thronos network.</span>
    </p>

    <div class="tab-buttons">
        <button class="tab-btn active" onclick="showTab('deploy')">
            <span class="lang-el">Î‘Î½Î¬Ï€Ï„Ï…Î¾Î·</span><span class="lang-en">Deploy</span>
        </button>
        <button class="tab-btn" onclick="showTab('call')">
            <span class="lang-el">ÎšÎ»Î®ÏƒÎ·</span><span class="lang-en">Call</span>
        </button>
        <button class="tab-btn" onclick="showTab('contracts')">
            <span class="lang-el">Î£Ï…Î¼Î²ÏŒÎ»Î±Î¹Î±</span><span class="lang-en">Contracts</span>
        </button>
        <button class="tab-btn" onclick="window.location.href='/tokens'">
            ğŸª™ <span class="lang-el">Î ÎµÎ¹ÏÎ±Î¼Î±Ï„Î¹ÎºÎ¬ Tokens</span><span class="lang-en">Experimental Tokens</span>
        </button>
        <button class="tab-btn" onclick="window.location.href='/pools'">
            ğŸ’§ <span class="lang-el">Liquidity Pools</span><span class="lang-en">Liquidity Pools</span>
        </button>
        <button class="tab-btn" onclick="window.location.href='/playground'">
            ğŸ® <span class="lang-el">DApp Playground</span><span class="lang-en">DApp Playground</span>
        </button>
    </div>

    <!-- Deploy Tab -->
    <div id="deploy-tab" class="tab-content active">
        <div class="evm-section">
            <h2><span class="lang-el">Î‘Î½Î¬Ï€Ï„Ï…Î¾Î· ÎÎ­Î¿Ï… Î£Ï…Î¼Î²Î¿Î»Î±Î¯Î¿Ï…</span><span class="lang-en">Deploy New Contract</span></h2>
            
            <div class="form-group">
                <label><span class="lang-el">THR Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·</span><span class="lang-en">THR Address</span>:</label>
                <input type="text" id="deploy-address" placeholder="THR...">
            </div>
            
            <div class="form-group">
                <label><span class="lang-el">Auth Secret</span><span class="lang-en">Auth Secret</span>:</label>
                <input type="password" id="deploy-secret" placeholder="Your auth secret">
            </div>
            
            <div class="form-group">
                <label><span class="lang-el">Passphrase (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ)</span><span class="lang-en">Passphrase (optional)</span>:</label>
                <input type="password" id="deploy-passphrase" placeholder="Optional passphrase">
            </div>
            
            <div class="form-group">
                <label><span class="lang-el">Bytecode (hex)</span><span class="lang-en">Bytecode (hex)</span>:</label>
                <textarea id="deploy-bytecode" placeholder="0x6080604052..."></textarea>
            </div>
            
            <div class="form-group">
                <label><span class="lang-el">Î‘Î¾Î¯Î± (THR)</span><span class="lang-en">Value (THR)</span>:</label>
                <input type="number" id="deploy-value" value="0" step="0.000001">
            </div>
            
            <div class="form-group">
                <label><span class="lang-el">Gas Limit</span><span class="lang-en">Gas Limit</span>:</label>
                <input type="number" id="deploy-gas" value="1000000">
            </div>
            
            <button class="btn-evm" onclick="deployContract()">
                <span class="lang-el">ğŸš€ Î‘Î½Î¬Ï€Ï„Ï…Î¾Î·</span><span class="lang-en">ğŸš€ Deploy</span>
            </button>
            
            <div id="deploy-result" class="result-box" style="display:none;"></div>
        </div>
    </div>

    <!-- Call Tab -->
    <div id="call-tab" class="tab-content">
        <div class="evm-section">
            <h2><span class="lang-el">ÎšÎ»Î®ÏƒÎ· Î£Ï…Î¼Î²Î¿Î»Î±Î¯Î¿Ï…</span><span class="lang-en">Call Contract</span></h2>
            
            <div class="form-group">
                <label><span class="lang-el">THR Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·</span><span class="lang-en">THR Address</span>:</label>
                <input type="text" id="call-address" placeholder="THR...">
            </div>
            
            <div class="form-group">
                <label><span class="lang-el">Auth Secret</span><span class="lang-en">Auth Secret</span>:</label>
                <input type="password" id="call-secret" placeholder="Your auth secret">
            </div>
            
            <div class="form-group">
                <label><span class="lang-el">Passphrase (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ)</span><span class="lang-en">Passphrase (optional)</span>:</label>
                <input type="password" id="call-passphrase" placeholder="Optional passphrase">
            </div>
            
            <div class="form-group">
                <label><span class="lang-el">Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· Î£Ï…Î¼Î²Î¿Î»Î±Î¯Î¿Ï…</span><span class="lang-en">Contract Address</span>:</label>
                <input type="text" id="call-contract" placeholder="CONTRACT_...">
            </div>
            
            <div class="form-group">
                <label><span class="lang-el">Call Data (hex)</span><span class="lang-en">Call Data (hex)</span>:</label>
                <textarea id="call-data" placeholder="0x..."></textarea>
            </div>
            
            <div class="form-group">
                <label><span class="lang-el">Î‘Î¾Î¯Î± (THR)</span><span class="lang-en">Value (THR)</span>:</label>
                <input type="number" id="call-value" value="0" step="0.000001">
            </div>
            
            <button class="btn-evm" onclick="callContract()">
                <span class="lang-el">ğŸ“ ÎšÎ»Î®ÏƒÎ·</span><span class="lang-en">ğŸ“ Call</span>
            </button>
            
            <div id="call-result" class="result-box" style="display:none;"></div>
        </div>
    </div>

    <!-- Contracts Tab -->
    <div id="contracts-tab" class="tab-content">
        <div class="evm-section">
            <h2><span class="lang-el">Î ÏÏŒÏƒÏ†Î±Ï„Î± Î£Ï…Î¼Î²ÏŒÎ»Î±Î¹Î±</span><span class="lang-en">Recent Contracts</span></h2>
            <ul id="contract-list" class="contract-list"></ul>
        </div>
    </div>
</div>

<script>
// Simple tab switcher
function showTab(name) {
    const tabs = ['deploy', 'call', 'contracts'];
    tabs.forEach(tab => {
        document.getElementById(tab + '-tab').classList.remove('active');
        document.querySelector('.tab-btn[onclick="showTab(\'' + tab + '\')"]').classList.remove('active');
    });
    document.getElementById(name + '-tab').classList.add('active');
    document.querySelector('.tab-btn[onclick="showTab(\'' + name + '\')"]').classList.add('active');
    if (name === 'contracts') {
        loadContracts();
    }
}

// Deploy contract
async function deployContract() {
    const address = document.getElementById('deploy-address').value.trim();
    const secret = document.getElementById('deploy-secret').value.trim();
    const passphrase = document.getElementById('deploy-passphrase').value.trim();
    const bytecode = document.getElementById('deploy-bytecode').value.trim();
    const value = parseFloat(document.getElementById('deploy-value').value) || 0;
    const gasLimit = parseInt(document.getElementById('deploy-gas').value) || 0;
    if (!address || !secret || !bytecode) {
        alert('Missing required fields');
        return;
    }
    const payload = {
        from: address,
        secret,
        passphrase,
        bytecode,
        value,
        gas: gasLimit
    };
    try {
        const res = await fetch('/api/v1/evm/deploy', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
        const data = await res.json();
        const box = document.getElementById('deploy-result');
        box.style.display = 'block';
        box.textContent = JSON.stringify(data, null, 2);
    } catch (err) {
        alert('Deploy failed');
    }
}

// Call contract
async function callContract() {
    const address = document.getElementById('call-address').value.trim();
    const secret = document.getElementById('call-secret').value.trim();
    const passphrase = document.getElementById('call-passphrase').value.trim();
    const contract = document.getElementById('call-contract').value.trim();
    const dataHex = document.getElementById('call-data').value.trim();
    const value = parseFloat(document.getElementById('call-value').value) || 0;
    if (!address || !secret || !contract || !dataHex) {
        alert('Missing required fields');
        return;
    }
    const payload = {
        from: address,
        secret,
        passphrase,
        contract,
        data: dataHex,
        value
    };
    try {
        const res = await fetch('/api/v1/evm/call', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
        const data = await res.json();
        const box = document.getElementById('call-result');
        box.style.display = 'block';
        box.textContent = JSON.stringify(data, null, 2);
    } catch (err) {
        alert('Call failed');
    }
}

// Load recent contracts
async function loadContracts() {
    try {
        const res = await fetch('/api/v1/evm/contracts');
        const data = await res.json();
        const list = document.getElementById('contract-list');
        list.innerHTML = '';
        (data.contracts || []).forEach(item => {
            const li = document.createElement('li');
            li.className = 'contract-item';
            li.textContent = JSON.stringify(item);
            list.appendChild(li);
        });
    } catch (err) {
        console.error('Failed to load contracts');
    }
}
</script>
{% endblock %}
