{% extends "base.html" %}

{% block title %}ğŸ’¼ THR Wallet Viewer{% endblock %}

{% block styles %}
<style>
    input, button {
      background: #111;
      color: #0f0;
      border: 1px solid #0f0;
      padding: 8px;
      margin: 10px 0;
      font-family: monospace;
    }
    button { cursor: pointer; }
    button:hover { background: #222; }
    
    .tx {
      margin-top: 20px;
      border-top: 1px dashed #0f0;
      padding-top: 10px;
    }
    .btc-val {
        color: #ff0;
        font-size: 0.9em;
    }
</style>
{% endblock %}

{% block content %}
  <h1>ğŸ’¼ <span class="lang-el">Î ÏÎ¿Î²Î¿Î»Î® Î Î¿ÏÏ„Î¿Ï†Î¿Î»Î¹Î¿Ï THR</span><span class="lang-en">THR Wallet Viewer</span></h1>
  <p><span class="lang-el">Î•Î¹ÏƒÎ¬Î³ÎµÏ„Îµ Î¼Î¹Î± Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· THR Î³Î¹Î± Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î¿ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ ÎºÎ±Î¹ Ï„Î¿ Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ ÏƒÏ…Î½Î±Î»Î»Î±Î³ÏÎ½:</span><span class="lang-en">Enter a THR address to view its balance and transaction history:</span></p>

  <div>
    <input type="text" id="thrAddress" placeholder="e.g. THR..." size="40" />
    <button onclick="loadWallet()">ğŸ” <span class="lang-el">Î ÏÎ¿Î²Î¿Î»Î®</span><span class="lang-en">View Wallet</span></button>
  </div>

  <h2>
      <span class="lang-el">Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î¿:</span><span class="lang-en">Balance:</span> 
      <span id="balance">0</span> THR 
      <span class="btc-val">(â‰ˆ <span id="btcValue">0.0000</span> BTC)</span>
  </h2>
  
  <div id="txHistory"><span class="lang-el">Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ ÏƒÏ…Î½Î±Î»Î»Î±Î³Î­Ï‚.</span><span class="lang-en">No transactions yet.</span></div>
{% endblock %}

{% block scripts %}
<script>
    async function loadWallet() {
      const addr = document.getElementById("thrAddress").value.trim();
      if (!addr) {
        alert("Please enter a THR address.");
        return;
      }
      try {
        const res = await fetch(`/wallet_data/${addr}`);
        if (!res.ok) throw new Error("Server returned " + res.status);
        const data = await res.json();
        
        const balance = parseFloat(data.balance);
        document.getElementById("balance").textContent = balance + " THR";
        
        // Calculate BTC value (Fixed rate for now: 1 THR = 0.0001 BTC)
        const btcVal = (balance * 0.0001).toFixed(8);
        document.getElementById("btcValue").textContent = btcVal;

        const div = document.getElementById("txHistory");
        if (!data.transactions.length) {
          div.textContent = "No transactions found.";
        } else {
          let html = "";
          data.transactions.forEach(tx => {
            html += `
            <div class="tx">
              <strong>${tx.timestamp}</strong><br>
              ${tx.from ? `From: ${tx.from}<br>` : ""}
              ${tx.to   ? `To: ${tx.to}<br>`     : ""}
              Amount: ${tx.amount ?? tx.reward ?? 0} ${tx.amount ? "" : "THR"}<br>
              ${tx.fee ? `Fee: ${tx.fee}` : ""}
            </div>`;
          });
          div.innerHTML = html;
        }
      } catch (e) {
        alert("Error loading wallet: " + e.message);
      }
    }
    
    // Check URL for address parameter if we want to support direct linking via JS (optional enhancement)
    // But server handles /wallet/<addr> redirect to this page, so we might want to grab it from URL path if needed, 
    // but currently server redirects to /wallet_data JSON or renders this template. 
    // The server route /wallet/<thr_addr> redirects to /wallet_data/<thr_addr> which returns JSON, 
    // so the user actually sees JSON if they go there directly. 
    // The previous implementation had /wallet rendering wallet_viewer.html.
    // Let's leave it as is.
</script>
{% endblock %}